{% extends "base.html" %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <h1>{{ user[1] }}'s Profile</h1>
        {% if 'user_id' in session and session['user_id'] != user[0] %}
            <div class="follow-button-container">
                {% if is_following %}
                    <button onclick="unfollowUser('{{ user[1] }}')" 
                            class="unfollow-button">
                        Unfollow
                    </button>
                {% else %}
                    <button onclick="followUser('{{ user[1] }}')" 
                            class="follow-button">
                        Follow
                    </button>
                {% endif %}
            </div>
        {% endif %}
        
        <div class="profile-stats">
            <div class="stat-box">
                <span class="stat-number">{{ stats[2] }}</span>
                <span class="stat-label">Snippets</span>
            </div>
            <div class="stat-box">
                <span class="stat-number">{{ stats[0] }}</span>
                <span class="stat-label">Followers</span>
            </div>
            <div class="stat-box">
                <span class="stat-number">{{ stats[1] }}</span>
                <span class="stat-label">Following</span>
            </div>
            <div class="stat-box">
                <span class="stat-number">{{ stats[3] }}</span>
                <span class="stat-label">Total Upvotes</span>
            </div>
        </div>
    </div>

    <div class="snippets-section">
        <h2>Public Snippets</h2>
        {% if snippets %}
            <div class="snippets-grid">
                {% for snippet in snippets %}
                <div class="snippet-card">
                    <h3>
                        <a href="{{ url_for('view_snippet_explore', id=snippet[0]) }}">
                            {{ snippet[1] }}
                        </a>
                    </h3>
                    <div class="snippet-meta">
                        <span class="language">{{ snippet[2] }}</span>
                        <span class="date">{{ snippet[3][:10] }}</span>
                    </div>
                    <div class="vote-stats">
                        <span class="upvotes">↑ {{ snippet[4] }}</span>
                        <span class="downvotes">↓ {{ snippet[5] }}</span>
                    </div>
                    <div class="snippet-actions">
                        <a href="{{ url_for('view_snippet_explore', id=snippet[0]) }}" 
                           class="view-button">
                            View Snippet
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-snippets">No public snippets yet.</p>
        {% endif %}
    </div>
</div>

<style>
.profile-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.profile-header {
    text-align: center;
    margin-bottom: 40px;
}

.follow-button-container {
    margin: 20px 0;
}

.follow-button, .unfollow-button {
    padding: 8px 24px;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s;
}

.follow-button {
    background: #2563eb;
    color: white;
    border: none;
}

.follow-button:hover {
    background: #1d4ed8;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.unfollow-button {
    background: #fff;
    color: #666;
    border: 1px solid #ddd;
}

.unfollow-button:hover {
    background: #f5f5f5;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.profile-stats {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 20px;
}

.stat-box {
    background: #f5f5f5;
    padding: 15px 25px;
    border-radius: 8px;
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 24px;
    font-weight: bold;
    color: #333;
}

.stat-label {
    font-size: 14px;
    color: #666;
}

.snippets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.snippet-card {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    transition: transform 0.2s;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.snippet-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.snippet-card h3 {
    margin: 0 0 10px 0;
}

.snippet-card a {
    color: #333;
    text-decoration: none;
}

.snippet-meta {
    display: flex;
    justify-content: space-between;
    color: #666;
    font-size: 14px;
    margin: 10px 0;
}

.vote-stats {
    display: flex;
    gap: 15px;
    color: #666;
    margin: 10px 0;
}

.no-snippets {
    text-align: center;
    color: #666;
    margin-top: 30px;
}

.snippet-actions {
    margin-top: 15px;
    text-align: center;
}

.view-button {
    display: inline-block;
    padding: 8px 16px;
    background: #2563eb;
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.2s;
}

.view-button:hover {
    background: #1d4ed8;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
</style>

<script>
function followUser(username) {
    fetch(`/follow/${username}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message);
        }
    });
}

function unfollowUser(username) {
    fetch(`/unfollow/${username}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message);
        }
    });
}
</script>
{% endblock %}